{
    "version": "https://jsonfeed.org/version/1",
    "title": "MrLee's Blog • All posts by \"docker\" tag",
    "description": "Web安全",
    "home_page_url": "https://arksec.net",
    "items": [
        {
            "id": "https://arksec.net/posts/f4d746ea.html",
            "url": "https://arksec.net/posts/f4d746ea.html",
            "title": "docker搭建苹果cms",
            "date_published": "2024-08-01T12:00:05.000Z",
            "content_html": "<p>首先安装 docker，参考<a href=\"https://arksec.net/posts/f255ffad.html\">这里</a><br>\n然后运行下面的命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> <span class=\"built_in\">log</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> conf</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> cms</span><br><span class=\"line\">docker run -d  --restart=always --name nginx -p 80:80 -p 443:443 -v 自定义路径:自定义路径 -v ./conf:/etc/nginx/nginx.conf -v  ./conf/conf.d:/etc/nginx/conf.d -v ./certs:/etc/nginx/certs -v ./cms:/var/www/html -v ./log/nginx:/var/log/nginx --<span class=\"built_in\">link</span> php:php nginx:alpine</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d --restart=always --name php -v 自定义路径:自定义路径 -v ./cms:/var/www/html kimoqi/php-fpm-all-ext:7.3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d --name mysql --restart=always -v 自定义路径:自定义路径 -p 自定义端口:3306  -e MYSQL_ROOT_PASSWORD=自定义密码 -e MYSQL_USER=自定义用户名  -e MYSQL_DATABASE=自定义数据库名 mysql:5.7</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>自行配置证书放到 certs</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl https://get.acme.sh | sh</span><br><span class=\"line\"></span><br><span class=\"line\">~/.acme.sh/acme.sh --register-account -m xxxx@gmail.com</span><br><span class=\"line\"></span><br><span class=\"line\">~/.acme.sh/acme.sh --issue -d 自定义域名 --standalone</span><br><span class=\"line\"></span><br><span class=\"line\">~/.acme.sh/acme.sh --installcert -d 自定义域名 --key-file certs/key.pem --fullchain-file certs/cert.pem</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>编写 nginx 配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections 1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    include       /etc/nginx/mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\">    </span><br><span class=\"line\">    client_max_body_size 1000m;  </span><br><span class=\"line\">    <span class=\"comment\">#上传限制参数1G以内文件可上传</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># HTTP server</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name 自定义域名;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Redirect all HTTP requests to HTTPS</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 301 https://$host<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># HTTPS server</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 443 ssl http2;</span><br><span class=\"line\">    server_name 自定义域名;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># http2 on;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    ssl_certificate /etc/nginx/certs/cert.pem;</span><br><span class=\"line\">    ssl_certificate_key /etc/nginx/certs/key.pem;</span><br><span class=\"line\"></span><br><span class=\"line\">    root /var/www/html/apple;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">    rewrite ^/index.php(.*)$ /index.php?s=<span class=\"variable\">$1</span> last;   </span><br><span class=\"line\">    rewrite ^/vip.php(.*)$ /vip.php?s=<span class=\"variable\">$1</span> last;    </span><br><span class=\"line\">    rewrite ^/api.php(.*)$ /api.php?s=<span class=\"variable\">$1</span> last; </span><br><span class=\"line\">    rewrite ^(.*)$ /index.php?s=<span class=\"variable\">$1</span> last;</span><br><span class=\"line\">        </span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># PHP-FPM configuration</span></span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">        fastcgi_pass php:9000;</span><br><span class=\"line\">        fastcgi_index index.php;</span><br><span class=\"line\">        fastcgi_param SCRIPT_FILENAME $document_root<span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">        include fastcgi_params;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下载源码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> cms/apple</span><br><span class=\"line\">wget https://github.com/magicblack/maccms_down/raw/master/maccms10.zip &amp;&amp; apt-get install -y unzip &amp;&amp; unzip maccms10.zip &amp;&amp; <span class=\"built_in\">rm</span> maccms10.zip </span><br><span class=\"line\"><span class=\"built_in\">mv</span> maccms10-master/* cms/apple</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下载主题</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> apple/template/ </span><br><span class=\"line\">wget https://github.com/kejilion/Website_source_code/raw/main/DYXS2.zip&amp;&amp; unzip DYXS2.zip &amp;&amp; <span class=\"built_in\">rm</span> DYXS2.zip</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>配置主题</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> cms/apple/template/DYXS2/asset/admin/Dyxs2.php cms/apple/application/admin/controller</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"built_in\">cp</span> cms/apple/template/DYXS2/asset/admin/dycms.html cms/apple/application/admin/view/system</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>修改登陆文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">mv</span> cms/apple/admin.php cms/apple/vip.php</span><br></pre></td></tr></table></figure>\n<p>赋予权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">exec</span> -it php <span class=\"built_in\">chmod</span> -R 777 /var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it nginx <span class=\"built_in\">chmod</span> -R 777 /var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 777 cms</span><br></pre></td></tr></table></figure>\n<p>重启 nginx</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker restart nginx</span><br></pre></td></tr></table></figure>\n<p>打开<a href=\"https://xn--eqrt2g/install.php%E6%8C%89%E6%8F%90%E7%A4%BA%E5%AE%89%E8%A3%85%E8%8B%B9%E6%9E%9Ccms\"> https:// 域名 /install.php 按提示安装苹果 cms</a><br>\n 进入首页 —— 自定义菜单配置，输入下面文字保存<br>\n电影先生 2.0,/vip.php/admin/Dyxs2/dyxs2set<br>\n 接下来安装超级播放器<a href=\"https://wwm.lanzn.com/iSRw11x3z0wf\">超级播放器</a>并上传到服务器 cms/play 下，nginx 配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># HTTPS server</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 443 ssl http2;</span><br><span class=\"line\">    server_name 自定义域名不能和第一个相同;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># http2 on;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    ssl_certificate /etc/nginx/certs/cert.pem;</span><br><span class=\"line\">    ssl_certificate_key /etc/nginx/certs/key.pem;</span><br><span class=\"line\"></span><br><span class=\"line\">    root /var/www/html/play/public;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">    rewrite ^/index.php(.*)$ /index.php?s=<span class=\"variable\">$1</span> last;   </span><br><span class=\"line\">    rewrite ^(.*)$ /index.php?s=<span class=\"variable\">$1</span> last;</span><br><span class=\"line\">    </span><br><span class=\"line\">        </span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># PHP-FPM configuration</span></span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">        fastcgi_pass php:9000;</span><br><span class=\"line\">        fastcgi_index index.php;</span><br><span class=\"line\">        fastcgi_param SCRIPT_FILENAME $document_root<span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">        include fastcgi_params;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>赋予权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> -R 777 cms</span><br></pre></td></tr></table></figure>\n<p>打开<a href=\"https://xn--eqrt2g/%E5%AE%89%E8%A3%85%EF%BC%8C%E6%8C%89%E7%85%A7%E6%96%87%E4%BB%B6%E8%87%AA%E5%B8%A6%E6%96%87%E6%A1%A3%E9%85%8D%E7%BD%AE\"> https:// 域名 / 安装，按照文件自带文档配置</a><br>\n解析接口配置为<a href=\"https://xn--eqrt2g/player/index.php?code=%E6%92%AD%E6%94%BE%E5%99%A8%E7%BC%96%E7%A0%81&amp;if=1&amp;url=\"> https:// 域名 /player/index.php?code = 播放器编码 &amp; if=1&amp;url=</a></p>\n<p>下载萌兔采集插件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> cms/apple</span><br><span class=\"line\">wget</span><br><span class=\"line\">https://www.mycj.pro/upload/%E8%90%8C%E8%8A%BD%E9%87%87%E9%9B%86%E6%8F%92%E4%BB%B6Pro%20v10.7.3.zip &amp;&amp; unzip <span class=\"string\">&#x27;萌芽采集插件Pro v10.7.3.zip&#x27;</span> &amp;&amp; <span class=\"built_in\">rm</span> <span class=\"string\">&#x27;萌芽采集插件Pro v10.7.3.zip&#x27;</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it php <span class=\"built_in\">chmod</span> -R 777 /var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it nginx <span class=\"built_in\">chmod</span> -R 777 /var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 777 cms</span><br></pre></td></tr></table></figure>\n<p>在后台 点击应用 —— 应用市场，找到萌芽插件点击启用，刷新后可在首页左下角找到萌芽采集资源，点击绑定分类，可自动设置分类，点击播放配置修改成<a href=\"https://xn--eqrt2g/player/index.php?code=%E6%92%AD%E6%94%BE%E5%99%A8%E7%BC%96%E7%A0%81&amp;if=1&amp;url=\"> https:// 域名 /player/index.php?code = 播放器编码 &amp; if=1&amp;url=</a><br>\n 点击采集内容</p>\n<p>最后大功告成<br>\n记得屏蔽进行 IP 限制</p>\n",
            "tags": [
                "docker"
            ]
        }
    ]
}