[{"title":"docker搭建苹果cms","path":"/posts/f4d746ea.html","content":"首先安装docker，参考[这里](https://arksec.net/posts/f255ffad.html)\n然后运行下面的命令\n```\nmkdir log\nmkdir conf\nmkdir cms\ndocker run -d  --restart=always --name nginx -p 80:80 -p 443:443 -v 自定义路径:自定义路径 -v ./conf:/etc/nginx/nginx.conf -v  ./conf/conf.d:/etc/nginx/conf.d -v ./certs:/etc/nginx/certs -v ./cms:/var/www/html -v ./log/nginx:/var/log/nginx --link php:php nginx:alpine\n\ndocker run -d --restart=always --name php -v 自定义路径:自定义路径 -v ./cms:/var/www/html kimoqi/php-fpm-all-ext:7.3\n\n\ndocker run -d --name mysql --restart=always -v 自定义路径:自定义路径 -p 自定义端口:3306  -e MYSQL_ROOT_PASSWORD=自定义密码 -e MYSQL_USER=自定义用户名  -e MYSQL_DATABASE=自定义数据库名 mysql:5.7\n\n\n```\n自行配置证书放到certs\n\n\n```\ncurl https://get.acme.sh | sh\n\n~/.acme.sh/acme.sh --register-account -m xxxx@gmail.com\n\n~/.acme.sh/acme.sh --issue -d 自定义域名 --standalone\n\n~/.acme.sh/acme.sh --installcert -d 自定义域名 --key-file certs/key.pem --fullchain-file certs/cert.pem\n\n```\n\n编写nginx配置文件\n\n```\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n    keepalive_timeout  65;\n    \n    client_max_body_size 1000m;  \n    #上传限制参数1G以内文件可上传\n\n\n# HTTP server\nserver {\n    listen 80;\n    server_name 自定义域名;\n\n    # Redirect all HTTP requests to HTTPS\n    return 301 https://$host$request_uri;\n}\n\n# HTTPS server\nserver {\n    listen 443 ssl http2;\n    server_name 自定义域名;\n\n    # http2 on;\n        \n    ssl_certificate /etc/nginx/certs/cert.pem;\n    ssl_certificate_key /etc/nginx/certs/key.pem;\n\n    root /var/www/html/apple;\n    index index.php;\n\n    rewrite ^/index.php(.*)$ /index.php?s=$1 last;   \n    rewrite ^/vip.php(.*)$ /vip.php?s=$1 last;    \n    rewrite ^/api.php(.*)$ /api.php?s=$1 last; \n    rewrite ^(.*)$ /index.php?s=$1 last;\n        \n    try_files $uri $uri/ =404;\n    \n    # PHP-FPM configuration\n    location ~ \\.php$ {\n        fastcgi_pass php:9000;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        include fastcgi_params;\n    }\n}\n\n}\n\n```\n下载源码\n```\nmkdir cms/apple\nwget https://github.com/magicblack/maccms_down/raw/master/maccms10.zip && apt-get install -y unzip && unzip maccms10.zip && rm maccms10.zip \nmv maccms10-master/* cms/apple\n\n\n```\n下载主题\n```\ncd apple/template/ \nwget https://github.com/kejilion/Website_source_code/raw/main/DYXS2.zip&& unzip DYXS2.zip && rm DYXS2.zip\n\n```\n配置主题\n```\ncd\ncp cms/apple/template/DYXS2/asset/admin/Dyxs2.php cms/apple/application/admin/controller\n \n cp cms/apple/template/DYXS2/asset/admin/dycms.html cms/apple/application/admin/view/system\n\n```\n修改登陆文件\n```\n\nmv cms/apple/admin.php cms/apple/vip.php\n```\n赋予权限\n```\ndocker exec -it php chmod -R 777 /var/www/html\n\ndocker exec -it nginx chmod -R 777 /var/www/html\n\nchmod -R 777 cms\n```\n重启nginx\n```\ndocker restart nginx\n```\n打开https://域名/install.php按提示安装苹果cms\n进入首页——自定义菜单配置，输入下面文字保存\n电影先生2.0,/vip.php/admin/Dyxs2/dyxs2set\n接下来安装超级播放器[超级播放器](https://wwm.lanzn.com/iSRw11x3z0wf)并上传到服务器cms/play下，nginx配置文件\n\n```\n# HTTPS server\nserver {\n    listen 443 ssl http2;\n    server_name 自定义域名不能和第一个相同;\n\n    # http2 on;\n        \n    ssl_certificate /etc/nginx/certs/cert.pem;\n    ssl_certificate_key /etc/nginx/certs/key.pem;\n\n    root /var/www/html/play/public;\n    index index.php;\n\n    rewrite ^/index.php(.*)$ /index.php?s=$1 last;   \n    rewrite ^(.*)$ /index.php?s=$1 last;\n    \n        \n    try_files $uri $uri/ =404;\n    \n    # PHP-FPM configuration\n    location ~ \\.php$ {\n        fastcgi_pass php:9000;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        include fastcgi_params;\n    }\n}\n```\n赋予权限\n```\nchmod -R 777 cms\n```\n打开https://域名/安装，按照文件自带文档配置\n解析接口配置为https://域名/player/index.php?code=播放器编码&if=1&url=\n\n下载萌兔采集插件\n\n```\ncd cms/apple\nwget\nhttps://www.mycj.pro/upload/%E8%90%8C%E8%8A%BD%E9%87%87%E9%9B%86%E6%8F%92%E4%BB%B6Pro%20v10.7.3.zip && unzip '萌芽采集插件Pro v10.7.3.zip' && rm '萌芽采集插件Pro v10.7.3.zip'\ndocker exec -it php chmod -R 777 /var/www/html\n\ndocker exec -it nginx chmod -R 777 /var/www/html\n\nchmod -R 777 cms\n```\n\n在后台 点击应用——应用市场，找到萌芽插件点击启用，刷新后可在首页左下角找到萌芽采集资源，点击绑定分类，可自动设置分类，点击播放配置修改成https://域名/player/index.php?code=播放器编码&if=1&url=\n点击采集内容\n\n最后大功告成\n记得屏蔽进行IP限制","tags":["docker"]},{"title":"alist","path":"/posts/7fc8ee4.html","content":"#### alist一键搭建教程\n##### 安装nginx\n```\n#首先安装nginx方便反向代理\napt install nginx\n```\n##### 申请证书\n```\ncurl https://get.acme.sh | sh -s email=my@example.com\nbash ~/.acme.sh/acme.sh --issue -d \"域名\" --standalone -k ec-256\nbash ~/.acme.sh/acme.sh --install-cert -d \"域名\" --key-file /root/private.key --fullchain-file /root/cert.crt --ecc\n```\n##### 编写nginx配置文件\n```\n#vim /etc/nginx/conf.d/test.conf\nserver {\n    listen 443 ssl default_server;\n    listen [::]:443 ssl default_server;\n    ssl_reject_handshake on;\n}\n\nserver {\n    listen 443 ssl;\n    listen [::]:443 ssl;\n    server_name example.com;  #域名\n    ssl_certificate example.com.crt; #证书\n    ssl_certificate_key example.com.key;#证书密钥\n}\nlocation / {\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  proxy_set_header X-Forwarded-Proto $scheme;\n  proxy_set_header Host $http_host;\n  proxy_set_header X-Real-IP $remote_addr;\n  proxy_set_header Range $http_range;\n\tproxy_set_header If-Range $http_if_range;\n  proxy_redirect off;\n  proxy_pass http://127.0.0.1:5244;\n  # the max size of file to upload\n  client_max_body_size 20000m;\n}\n\n```\n##### 安装docker\n```\ncurl -sSL https://get.docker.com/ | sh\nsystemctl start docker\nsystemctl enable docker\n```\n##### 安装alist\n```\ndocker run -d --restart=always -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=\"alist\" xhofe/alist-aria2:latest\n```\n##### 添加一起看功能\n```\n#alist后台>全局设置\n<script src=\"https://2gether.video/release/extension.website.user.js\"></script>\n<script>\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const seAList = document.createElement(\"style\");\n\n  seAList.innerHTML = `\n    .left-toolbar-box {\n        left: var(--hope-space-5);\n        right: auto;\n    }\n`;\n\n  document.body.appendChild(seAList);\n});\n</script>\n```"},{"title":"cobaltstrike免杀记录","path":"/posts/c16c6dcf.html","content":"待更新。。。","tags":["cs,免杀,Web安全"]},{"title":"ipv6","path":"/posts/8544442c.html","content":"之前收了个server-factory的v6小鸡，记录一下折腾历史。\n首先让小鸡支持访问ipv4的网站，\n```\nmv /etc/resolv.conf /etc/resolv.conf.bak && echo -e \"nameserver 2001:67c:2b0::4\\nnameserver 2001:67c:2b0::6\" > /etc/resolv.conf\n```\n然后就安装warp添加ipv4\n```\nwget -N https://gitlab.com/fscarmen/warp/-/raw/main/menu.sh && bash menu.sh 4 Lisence 设备名\n#参考https://gitlab.com/fscarmen/warp/-/blob/main/README.md#warp-%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC\n```"},{"title":"vps","path":"/posts/490e9480.html","content":"#### 修改ssh端口\n``` bash\nsed -i \"s/#Port 22/Port 38752/g\" /etc/ssh/sshd_config\n#或者使用脚本\nwget https://www.moerats.com/usr/down/sshport.sh\nbash sshport.sh\nservice ssh restart\n```\n\n#### 添加Swap虚拟内存\n``` bash\nwget https://www.moerats.com/usr/shell/swap.sh && bash swap.sh\n```\n\n#### 防ssh爆破\n``` bash\napt install iptables fail2ban -y\nvim /etc/fail2ban/jail.d/jail.local\nservice fail2ban restart\nservice fail2ban status\n\n#jail.local\n[sshd]\nport = 38752\nmaxretry = 3\nbantime = 6d\n\n```"},{"title":"docker","path":"/posts/f255ffad.html","content":"``` bash\n#install\ncurl -sSL https://get.docker.com/ | sh\nsystemctl start docker\nsystemctl enable docker\n#remove\ndocker stop $(docker ps -a -q)\ndocker rm $(docker ps -a -q)\ndocker rmi $(docker images -q)\n\napt purge docker docker-engine docker.io containerd runc  docker-ce-cli docker-ce\n```"}]